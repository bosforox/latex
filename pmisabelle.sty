% Poor man's Isabelle markup
% Author: Christoph Lange <math.semantic.web@gmail.com>
% https://github.com/clange/latex
\NeedsTeXFormat{LaTeX2e}[1999/12/01]
\ProvidesPackage{pmisabelle}[2013/10/03]
\RequirePackage{amsmath}
% Example: a lemma
%
% LaTeX:
% \begin{pmi}
%   \pmikw*{lemma}\pminl
%   \quad\pmikw{fixes} \pmiid*{valid}::\text{``}\pmiid*{'Inputs} \Rightarrow \pmiid*{bool}\text{''}\pminl
%   \quad\pmikw{and} R::\pmitm*{(\pmiid*{'Inputs} \times \pmiid*{'Outcomes})\ set\text{''}}\pminl
%   \quad\pmikw{shows}\ \pmitm{(\forall \pmiid*{inp}\pmidot\pmiid{valid} \pmiid*{inp} \longrightarrow (\exists \pmiid*{out}\pmidot(\pmiid*{inp}, \pmiid*{out}) \in R))\pminl
%   \qquad\longleftrightarrow \pmiid{Domain} R \supseteq \{ \pmiid*{inp}\pmidot\pmiid{valid} \pmiid*{inp}\}}\pminl
%   \quad\pmikw{by} \pmiid*{blast}\pmill
% \end{pmi}
%
% Isabelle:
% lemma
%   fixes valid::"'Inputs ⇒ bool"
%     and R::"('Inputs × 'Outcomes) set"
%   shows "(∀ inp . valid inp ⟶ (∃ out . (inp, out) ∈ R)) ⟷ Domain R ⊇ { inp . valid inp }"
%   by blast

% the environment in which all of the following commands should be used
\newenvironment{pmi}{%
  \setlength{\jot}{0pt}
  \start@align\tw@\st@rredtrue\m@ne&
}{%         
  \endalign
}
% a new line
\newcommand*{\pminl}{&\\ &}
% last line
\newcommand*{\pmill}{&}
% the dot after quantified variables (with some space)
\newcommand*{\pmidot}{\,.\,}
% The following commands normally have a space appended, unless you use the starred variant.
% keyword of the Isabelle/Isar language
\newcommand*{\pmikwstar}[1]{\mathbf{#1}}
\newcommand*{\pmikwnostar}[1]{\pmikwstar{#1}\ }
\newcommand\pmikw{\@ifstar\pmikwstar\pmikwnostar}
% identifier
\newcommand*{\pmiidstar}[1]{\mathit{#1}}
\newcommand*{\pmiidnostar}[1]{\pmiidstar{#1}\ }
\newcommand\pmiid{\@ifstar\pmiidstar\pmiidnostar}
% term in "…"
\newcommand*{\pmitmstar}[1]{\text{``}#1\text{''}}
\newcommand*{\pmitmnostar}[1]{\pmitmstar{#1}\ }
\newcommand\pmitm{\@ifstar\pmitmstar\pmitmnostar}
